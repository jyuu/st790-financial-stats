---
output: 
  pdf_document:
    keep_tex: true
    fig_caption: true
    template: ~/workspace/cv/git/svm-latex-ms.tex
title: "Homework 2"
author: 
  name: "Joyce Yu Cahoon"
#abstract: "Application of sequential monte carlo (SMC) to the development of IM plausibility functions for the Nile."
# bibliography: /Users/jcahoon/workspace/metar/ref.bib
#bibliography: /home/joyce/workspace/metar/ref.bib
date: "`r format(Sys.time(), '%B %d, %Y')`"
geometry: margin=1in
fontfamily: mathpazo
fontsize: 11pt
# spacing: double
endnote: no
header-includes:
- \setlength{\abovedisplayskip}{.2pt}
- \setlength{\belowdisplayskip}{.2pt}
- \usepackage{placeins}
- \usepackage{setspace}
- \usepackage{chngcntr}
- \usepackage{multicol}
- \usepackage{lscape}
- \counterwithin{figure}{section}
- \counterwithin{table}{section}
- \usepackage{mathrsfs}
- \usepackage{mathtools}
- \usepackage{multirow}
- \newtheorem{theorem}{Theorem}
- \usepackage[linesnumbered,algoruled,boxed,lined,commentsnumbered]{algorithm2e} 
- \usepackage{bm}
- \usepackage{framed}
- \usepackage{xcolor}
- \let\oldquote=\quote
- \let\endoldquote=\endquote
- \colorlet{shadecolor}{orange!15}
- \renewenvironment{quote}{\begin{shaded*}\begin{oldquote}}{\end{oldquote}\end{shaded*}}
- \newcommand{\V}[1]{{\bm{{#1}}}}
--- 

```{r, echo = FALSE, message=FALSE, warning=FALSE}
library(quantmod)
```

# 5.2 

Let $s_A$ and $s_B$ be the Sharpe ratio of portfolios A and B. Let $r_A$ and $r_B$ be the expected returns of these two portfolios, with standard deviation denoted by $\sigma_A$ and $\sigma_B$. Assume that through self financing, portfolio A borrows ($\sigma_B/\sigma_A-1$) at risk-free rate $r_f$ to leverage so that its risk is now the same as that of portfolio B. 

Show that the excess return of leveraged investment in portfolio A is larger than the expected return of portfolio B if $s_A > s_B$. This shows that the Sharpe ratio measures the efficiency of a portfolio. 

\newpage 

# 5.3 

Suppose that three mutual funds (conservative, growth and aggressive) have annual log-returns of 15\%, 20\% and 30\% with volatility of 20\%, 30\% and 50\% respectively. The correlation between any of the 2 funds is 0 and the risk-free rate is 5\%.  

```{r}
rf <- .05
vol <- c(.20, .30, .50)
r <- c(.15, .20, .30) 
expected_return <- .15 
Y <- r - rf # excess returns 
gamma <- diag(x = 1, nrow = 3) 
vol <- diag(vol, nrow = 3) 
Sigma <- vol %*% gamma %*% vol
partial_alpha <- as.vector(solve(Sigma) %*% Y ) 
A <- sum(partial_alpha * Y)/(expected_return - rf)
a.est <- 1/A*solve(Sigma) %*% Y
```

1. What is the min variance portfolio with these 3 mutual funds?
2. Find the optimal portfolio allocation among the 3 mutual funds, if the expected return is set at 15\%. Give the associated standard deviation of this portfolio.
3. Compute the Sharpe ratio for the portfolio in A. How does it compare with that in B? 


```{r, echo = FALSE} 
cat("Our risk aversion parameter A is: ", A, "\n")
cat("Our optimal portfolio allocation is: ", a.est, "\n", 
    "for the conservative, growth and aggressive funds, respectively", "\n") 
cat("Our min variance is given by: ", t(a.est) %*% Sigma %*% a.est, "\n")

```

\newpage

# 5.10

Let $Y$ be the excess returns of risky assets. Let $X = a^TY$ be a portfolio with allocation vector $a$. Denote by $\Sigma = \text{var}(Y)$ and $\mu = \mathbb{E}(Y)$. Consider the following decomposition: 

$$
Y = \alpha + \beta X + \epsilon \quad \mathbb{E}(\epsilon) = 0 \quad \text{cov}(\epsilon, X) = 0
$$

1. Show that if $a = c\Sigma^{-1}\mu$ then $\alpha =0$.

2. Conversely if $\alpha = 0$, there exists a constant $c$ such that $a = c\Sigma^{-1}\mu_0$

\newpage

# 5.13 

Consider the following portfolio optimization problem with a risk-free asset having return $r_0$: 

$$
\min{\V{\alpha}^T \Sigma \V{\alpha}} \quad \text{such that} \quad \V{\alpha}^T \V{\mu} + (1-\V{\alpha}^T\V{1}) r_0 = \mu
$$

1. The optimal solution is $\V{\alpha} = P^{-1} (\mu-r_0)\Sigma^{-1}\mu_0$ where $P = \V{\mu}_0^T \Sigma^{-1} \V{\mu}_0^T$ is the squared Sharpe ratio, and $\V{\mu}_0 = \V{\mu}-r_0\V{1}$ is the vector of excess returns. 

2. The variance of this portfolio is $\sigma^2 = (\mu - r_0)^2 / P$. 

3. When $r_0 < \mu$, show that $r_0 + P^{1/2} \sigma = \mu$, namely the optimal allocation for the risky asset $\V{\alpha}$ is the tangent portfolio. 

\newpage 

# 5.14

1. Download the monthly data for 8 stocks. 

```{r, eval = FALSE}
library(quantmod)
start <- as.Date("2001-01-01")
end <- as.Date("2014-12-29")
getSymbols("DGS3MO", src = "FRED", from = start, to = end) # TREASURY
symbols <- c("SPY", 
             #"DVMT", # DELL DOES NOT WORK
             "F",  # FORD
             "GE", 
             "IBM",
             "INTC", # INTEL
             "JNJ", # JOHNSON 
             "MRK", # MERCK
             "MSFT") # MICROSOFT
getSymbols(symbols, from = start, to = end) 
closing.prices <- merge.xts(DGS3MO,
                            SPY[,4], 
                            F[,4], 
                            GE[,4], 
                            IBM[,4], 
                            INTC[,4], 
                            JNJ[,4], 
                            MRK[,4], 
                            MSFT[,4])
volume <- merge.xts(DGS3MO,
                            SPY[,5], 
                            F[,5], 
                            GE[,5], 
                            IBM[,5], 
                            INTC[,5], 
                            JNJ[,5], 
                            MRK[,5], 
                            MSFT[,5])
saveRDS(closing.prices, "~/workspace/st790-financial-stats/data/hw2_closingprices.rds")
saveRDS(volume, "~/workspace/st790-financial-stats/data/hw2_volume.rds")
```

2. Construct the optimal allocation using the monthly data. 

```{r}
closing.prices <- readRDS("~/workspace/st790-financial-stats/data/hw2_closingprices.rds") 
data <- closing.prices["2001-01-02/2011-12-31"]
data <- na.omit(data)
by_month <- data.frame()
for (i in 1:ncol(data)){ 
  temp <- data[,i]
  monthly <- log(monthlyReturn(temp)+1)
  by_month <- cbind(by_month, monthly )
  colnames(by_month)[i] <- strsplit(names(temp), "[.]")[[1]][1]
}
# get the excess return 
excess_return <- data.frame() 
for(j in 2:ncol(by_month)){ 
  temp <- by_month[,j] - by_month[,1] # subtract the 3 mo treas rate
  excess_return <- cbind(excess_return, temp)
  colnames(excess_return)[j-1] <- names(temp)
}
# get the alphas 
alphas <- c() 
betas <- c()
for(k in 2:ncol(excess_return)){
  results <- lsfit(excess_return[,1], excess_return[,k])$coefficients
  alphas <- c(alphas, results[1])
  betas <- c(betas, results[2])
}
# get the residuals 
x <- excess_return$SPY
y <- excess_return[,c(2:8)]
residuals <- resid(lsfit(x, y))
Sigma <- t(residuals) %*% residuals / dim(y)[1]
mreturn <- mean(x) 
msigma <- var(x)
T0 <- dim(y)[1]/( 1+mreturn^2/msigma ) * t(alphas) %*% solve(Sigma, alphas) # for testing
# get the optimal allocation
Y <- apply(y, 2, mean)# excess returns 
partial_alpha <- as.vector(solve(Sigma) %*% Y ) 
A <- sum(partial_alpha)/.8 # since invest 20% in riskless asset
a.est <- 1/A*solve(Sigma) %*% Y
rownames(a.est) <- names(y)
#print("This is the optimal allocation:")
knitr::kable(t(a.est))
```

3. If allocation is fixed over the next 2 years, compare the performance of the portfolio over next 6-mo, one-yr, two-year, and three-year: 

```{r}
data <- closing.prices["2011-12-31/2012-05-31"]
data <- na.omit(data)
by_month <- data.frame()
for (i in 1:ncol(data)){ 
  temp <- data[,i]
  monthly <- log(monthlyReturn(temp)+1)
  by_month <- cbind(by_month, monthly )
  colnames(by_month)[i] <- strsplit(names(temp), "[.]")[[1]][1]
}
# get the excess return 
excess_return <- data.frame() 
for(j in 2:ncol(by_month)){ 
  temp <- by_month[,j] - by_month[,1] # subtract the 3 mo treas rate
  excess_return <- cbind(excess_return, temp)
  colnames(excess_return)[j-1] <- names(temp)
}
# get the residuals 
x <- excess_return$SPY
y <- excess_return[,c(2:8)]
residuals <- resid(lsfit(x, y))
Sigma <- t(residuals) %*% residuals / dim(y)[1]
# calculate excess returns over 6 month period 
y_6 <- apply(y, 2, mean)
# calculate the risk free rate return 
rf <- mean(by_month$DGS3MO)
# log return 
mu_6 <- rf + sum(as.vector(a.est)*(y_6))
# volatility
std_6 <- sqrt(t(a.est) %*% Sigma %*% a.est)
# Sharpe ratio
s_6 <- (mu_6 - rf)/std_6 
# Repeat the above process for one year and two year and three year
```

```{r, echo = FALSE, warning = FALSE, message = FALSE }
# one year 
data <- closing.prices["2011-12-31/2012-12-31"]
data <- na.omit(data)
by_month <- data.frame()
for (i in 1:ncol(data)){ 
  temp <- data[,i]
  monthly <- log(monthlyReturn(temp)+1)
  by_month <- cbind(by_month, monthly )
  colnames(by_month)[i] <- strsplit(names(temp), "[.]")[[1]][1]
}
# get the excess return 
excess_return <- data.frame() 
for(j in 2:ncol(by_month)){ 
  temp <- by_month[,j] - by_month[,1] # subtract the 3 mo treas rate
  excess_return <- cbind(excess_return, temp)
  colnames(excess_return)[j-1] <- names(temp)
}
# get the residuals 
x <- excess_return$SPY
y <- excess_return[,c(2:8)]
residuals <- resid(lsfit(x, y))
Sigma <- t(residuals) %*% residuals / dim(y)[1]
# calculate excess returns over 6 month period 
y_12 <- apply(y, 2, mean)
# calculate the risk free rate return 
rf <- mean(by_month$DGS3MO)
# log return 
mu_12 <- rf + sum(as.vector(a.est)*(y_12))
# volatility
std_12 <- sqrt(t(a.est) %*% Sigma %*% a.est)
# Sharpe ratio
s_12 <- (mu_12 - rf)/std_12
```

```{r, echo = FALSE, warning = FALSE, message = FALSE }
# two year 
data <- closing.prices["2011-12-31/2013-12-31"]
data <- na.omit(data)
by_month <- data.frame()
for (i in 1:ncol(data)){ 
  temp <- data[,i]
  monthly <- log(monthlyReturn(temp)+1)
  by_month <- cbind(by_month, monthly )
  colnames(by_month)[i] <- strsplit(names(temp), "[.]")[[1]][1]
}
# get the excess return 
excess_return <- data.frame() 
for(j in 2:ncol(by_month)){ 
  temp <- by_month[,j] - by_month[,1] # subtract the 3 mo treas rate
  excess_return <- cbind(excess_return, temp)
  colnames(excess_return)[j-1] <- names(temp)
}
# get the residuals 
x <- excess_return$SPY
y <- excess_return[,c(2:8)]
residuals <- resid(lsfit(x, y))
Sigma <- t(residuals) %*% residuals / dim(y)[1]
# calculate excess returns over 6 month period 
y_24 <- apply(y, 2, mean)
# calculate the risk free rate return 
rf <- mean(by_month$DGS3MO)
# log return 
mu_24 <- rf + sum(as.vector(a.est)*(y_24))
# volatility
std_24 <- sqrt(t(a.est) %*% Sigma %*% a.est)
# Sharpe ratio
s_24 <- (mu_24 - rf)/std_24
```


```{r, echo = FALSE, warning = FALSE, message = FALSE }
# three year 
data <- closing.prices["2011-12-31/2014-12-31"]
data <- na.omit(data)
by_month <- data.frame()
for (i in 1:ncol(data)){ 
  temp <- data[,i]
  monthly <- log(monthlyReturn(temp)+1)
  by_month <- cbind(by_month, monthly )
  colnames(by_month)[i] <- strsplit(names(temp), "[.]")[[1]][1]
}
# get the excess return 
excess_return <- data.frame() 
for(j in 2:ncol(by_month)){ 
  temp <- by_month[,j] - by_month[,1] # subtract the 3 mo treas rate
  excess_return <- cbind(excess_return, temp)
  colnames(excess_return)[j-1] <- names(temp)
}
# get the residuals 
x <- excess_return$SPY
y <- excess_return[,c(2:8)]
residuals <- resid(lsfit(x, y))
Sigma <- t(residuals) %*% residuals / dim(y)[1]
# calculate excess returns over 6 month period 
y_36 <- apply(y, 2, mean)
# calculate the risk free rate return 
rf <- mean(by_month$DGS3MO)
# log return 
mu_36 <- rf + sum(as.vector(a.est)*(y_36))
# volatility
std_36 <- sqrt(t(a.est) %*% Sigma %*% a.est)
# Sharpe ratio
s_36 <- (mu_36 - rf)/std_36
```

```{r , echo = FALSE}
results <- data.frame(timeline = c("6 Months", "1 Year", "2 Years", "3 Years"),
                      return = c(mu_6, mu_12, mu_24, mu_36), 
                      volatility = c(std_6, std_12, std_24, std_36), 
                      sharpe = c(s_6, s_12, s_24, s_36))
knitr::kable(results)
```

\newpage 

4. Create a value weighted portfolio. 

```{r, echo = FALSE}
volume <- readRDS("~/workspace/st790-financial-stats/data/hw2_volume.rds")
data_volume <- volume["2011-01-01/2011-12-31"]
data_volume <- na.omit(data_volume)
data_close <- closing.prices["2011-01-01/2011-12-31"]
data_close <- na.omit(data_close)
# break it down by monthly 
by_month <- data.frame()
for (i in 1:ncol(data)){ 
  temp <- data_close[,i]
  monthly <- log(monthlyReturn(temp)+1)
  by_month <- cbind(by_month, monthly )
  colnames(by_month)[i] <- strsplit(names(temp), "[.]")[[1]][1]
}
# get average vol*close weights 
composite <- data_volume * data_close
weights <- composite[,3:9]
w <- apply(weights, 2, mean)
w <- .8*w/sum(w) 
names(w) <- names(by_month)[3:9]
#print("This is the optimal allocation weighted by value:")
knitr::kable((t(w)))
```

Compare the performance:

```{r, echo = FALSE}
data <- closing.prices["2011-12-31/2012-05-31"]
data <- na.omit(data)
by_month <- data.frame()
for (i in 1:ncol(data)){ 
  temp <- data[,i]
  monthly <- log(monthlyReturn(temp)+1)
  by_month <- cbind(by_month, monthly )
  colnames(by_month)[i] <- strsplit(names(temp), "[.]")[[1]][1]
}
# get the excess return 
excess_return <- data.frame() 
for(j in 2:ncol(by_month)){ 
  temp <- by_month[,j] - by_month[,1] # subtract the 3 mo treas rate
  excess_return <- cbind(excess_return, temp)
  colnames(excess_return)[j-1] <- names(temp)
}
# get the residuals 
x <- excess_return$SPY
y <- excess_return[,c(2:8)]
residuals <- resid(lsfit(x, y))
Sigma <- t(residuals) %*% residuals / dim(y)[1]
# calculate excess returns over 6 month period 
y_6 <- apply(y, 2, mean)
# calculate the risk free rate return 
rf <- mean(by_month$DGS3MO)
# log return 
mu_6 <- rf + sum(as.vector(w)*(y_6))
# volatility
std_6 <- sqrt(w %*% Sigma %*% w)
# Sharpe ratio
s_6 <- (mu_6 - rf)/std_6 
# one year 
data <- closing.prices["2011-12-31/2012-12-31"]
data <- na.omit(data)
by_month <- data.frame()
for (i in 1:ncol(data)){ 
  temp <- data[,i]
  monthly <- log(monthlyReturn(temp)+1)
  by_month <- cbind(by_month, monthly )
  colnames(by_month)[i] <- strsplit(names(temp), "[.]")[[1]][1]
}
# get the excess return 
excess_return <- data.frame() 
for(j in 2:ncol(by_month)){ 
  temp <- by_month[,j] - by_month[,1] # subtract the 3 mo treas rate
  excess_return <- cbind(excess_return, temp)
  colnames(excess_return)[j-1] <- names(temp)
}
# get the residuals 
x <- excess_return$SPY
y <- excess_return[,c(2:8)]
residuals <- resid(lsfit(x, y))
Sigma <- t(residuals) %*% residuals / dim(y)[1]
# calculate excess returns over 6 month period 
y_12 <- apply(y, 2, mean)
# calculate the risk free rate return 
rf <- mean(by_month$DGS3MO)
# log return 
mu_12 <- rf + sum(as.vector(w)*(y_12))
# volatility
std_12 <- sqrt(w %*% Sigma %*% w)
# Sharpe ratio
s_12 <- (mu_12 - rf)/std_12
# two year 
data <- closing.prices["2011-12-31/2013-12-31"]
data <- na.omit(data)
by_month <- data.frame()
for (i in 1:ncol(data)){ 
  temp <- data[,i]
  monthly <- log(monthlyReturn(temp)+1)
  by_month <- cbind(by_month, monthly )
  colnames(by_month)[i] <- strsplit(names(temp), "[.]")[[1]][1]
}
# get the excess return 
excess_return <- data.frame() 
for(j in 2:ncol(by_month)){ 
  temp <- by_month[,j] - by_month[,1] # subtract the 3 mo treas rate
  excess_return <- cbind(excess_return, temp)
  colnames(excess_return)[j-1] <- names(temp)
}
# get the residuals 
x <- excess_return$SPY
y <- excess_return[,c(2:8)]
residuals <- resid(lsfit(x, y))
Sigma <- t(residuals) %*% residuals / dim(y)[1]
# calculate excess returns over 6 month period 
y_24 <- apply(y, 2, mean)
# calculate the risk free rate return 
rf <- mean(by_month$DGS3MO)
# log return 
mu_24 <- rf + sum(as.vector(w)*(y_24))
# volatility
std_24 <- sqrt(w %*% Sigma %*% w)
# Sharpe ratio
s_24 <- (mu_24 - rf)/std_24
# three year 
data <- closing.prices["2011-12-31/2014-12-31"]
data <- na.omit(data)
by_month <- data.frame()
for (i in 1:ncol(data)){ 
  temp <- data[,i]
  monthly <- log(monthlyReturn(temp)+1)
  by_month <- cbind(by_month, monthly )
  colnames(by_month)[i] <- strsplit(names(temp), "[.]")[[1]][1]
}
# get the excess return 
excess_return <- data.frame() 
for(j in 2:ncol(by_month)){ 
  temp <- by_month[,j] - by_month[,1] # subtract the 3 mo treas rate
  excess_return <- cbind(excess_return, temp)
  colnames(excess_return)[j-1] <- names(temp)
}
# get the residuals 
x <- excess_return$SPY
y <- excess_return[,c(2:8)]
residuals <- resid(lsfit(x, y))
Sigma <- t(residuals) %*% residuals / dim(y)[1]
# calculate excess returns over 6 month period 
y_36 <- apply(y, 2, mean)
# calculate the risk free rate return 
rf <- mean(by_month$DGS3MO)
# log return 
mu_36 <- rf + sum(as.vector(w)*(y_36))
# volatility
std_36 <- sqrt((w) %*% Sigma %*% w)
# Sharpe ratio
s_36 <- (mu_36 - rf)/std_36
results <- data.frame(timeline = c("6 Months", "1 Year", "2 Years", "3 Years"),
                      return = c(mu_6, mu_12, mu_24, mu_36), 
                      volatility = c(std_6, std_12, std_24, std_36), 
                      sharpe = c(s_6, s_12, s_24, s_36))
knitr::kable(results)
```


5. Create a portfolio with .114 invested in each stock and .2 in the risk-free bond, and compare the performance as before. Note that we only have 7 stocks since DELL is not provided by Yahoo.

```{r, echo = FALSE}
w <- rep(.8/7, 7)
data <- closing.prices["2011-12-31/2012-05-31"]
data <- na.omit(data)
by_month <- data.frame()
for (i in 1:ncol(data)){ 
  temp <- data[,i]
  monthly <- log(monthlyReturn(temp)+1)
  by_month <- cbind(by_month, monthly )
  colnames(by_month)[i] <- strsplit(names(temp), "[.]")[[1]][1]
}
# get the excess return 
excess_return <- data.frame() 
for(j in 2:ncol(by_month)){ 
  temp <- by_month[,j] - by_month[,1] # subtract the 3 mo treas rate
  excess_return <- cbind(excess_return, temp)
  colnames(excess_return)[j-1] <- names(temp)
}
# get the residuals 
x <- excess_return$SPY
y <- excess_return[,c(2:8)]
residuals <- resid(lsfit(x, y))
Sigma <- t(residuals) %*% residuals / dim(y)[1]
# calculate excess returns over 6 month period 
y_6 <- apply(y, 2, mean)
# calculate the risk free rate return 
rf <- mean(by_month$DGS3MO)
# log return 
mu_6 <- rf + sum(as.vector(w)*(y_6))
# volatility
std_6 <- sqrt(w %*% Sigma %*% w)
# Sharpe ratio
s_6 <- (mu_6 - rf)/std_6 
# one year 
data <- closing.prices["2011-12-31/2012-12-31"]
data <- na.omit(data)
by_month <- data.frame()
for (i in 1:ncol(data)){ 
  temp <- data[,i]
  monthly <- log(monthlyReturn(temp)+1)
  by_month <- cbind(by_month, monthly )
  colnames(by_month)[i] <- strsplit(names(temp), "[.]")[[1]][1]
}
# get the excess return 
excess_return <- data.frame() 
for(j in 2:ncol(by_month)){ 
  temp <- by_month[,j] - by_month[,1] # subtract the 3 mo treas rate
  excess_return <- cbind(excess_return, temp)
  colnames(excess_return)[j-1] <- names(temp)
}
# get the residuals 
x <- excess_return$SPY
y <- excess_return[,c(2:8)]
residuals <- resid(lsfit(x, y))
Sigma <- t(residuals) %*% residuals / dim(y)[1]
# calculate excess returns over 6 month period 
y_12 <- apply(y, 2, mean)
# calculate the risk free rate return 
rf <- mean(by_month$DGS3MO)
# log return 
mu_12 <- rf + sum(as.vector(w)*(y_12))
# volatility
std_12 <- sqrt(w %*% Sigma %*% w)
# Sharpe ratio
s_12 <- (mu_12 - rf)/std_12
# two year 
data <- closing.prices["2011-12-31/2013-12-31"]
data <- na.omit(data)
by_month <- data.frame()
for (i in 1:ncol(data)){ 
  temp <- data[,i]
  monthly <- log(monthlyReturn(temp)+1)
  by_month <- cbind(by_month, monthly )
  colnames(by_month)[i] <- strsplit(names(temp), "[.]")[[1]][1]
}
# get the excess return 
excess_return <- data.frame() 
for(j in 2:ncol(by_month)){ 
  temp <- by_month[,j] - by_month[,1] # subtract the 3 mo treas rate
  excess_return <- cbind(excess_return, temp)
  colnames(excess_return)[j-1] <- names(temp)
}
# get the residuals 
x <- excess_return$SPY
y <- excess_return[,c(2:8)]
residuals <- resid(lsfit(x, y))
Sigma <- t(residuals) %*% residuals / dim(y)[1]
# calculate excess returns over 6 month period 
y_24 <- apply(y, 2, mean)
# calculate the risk free rate return 
rf <- mean(by_month$DGS3MO)
# log return 
mu_24 <- rf + sum(as.vector(w)*(y_24))
# volatility
std_24 <- sqrt(w %*% Sigma %*% w)
# Sharpe ratio
s_24 <- (mu_24 - rf)/std_24
# three year 
data <- closing.prices["2011-12-31/2014-12-31"]
data <- na.omit(data)
by_month <- data.frame()
for (i in 1:ncol(data)){ 
  temp <- data[,i]
  monthly <- log(monthlyReturn(temp)+1)
  by_month <- cbind(by_month, monthly )
  colnames(by_month)[i] <- strsplit(names(temp), "[.]")[[1]][1]
}
# get the excess return 
excess_return <- data.frame() 
for(j in 2:ncol(by_month)){ 
  temp <- by_month[,j] - by_month[,1] # subtract the 3 mo treas rate
  excess_return <- cbind(excess_return, temp)
  colnames(excess_return)[j-1] <- names(temp)
}
# get the residuals 
x <- excess_return$SPY
y <- excess_return[,c(2:8)]
residuals <- resid(lsfit(x, y))
Sigma <- t(residuals) %*% residuals / dim(y)[1]
# calculate excess returns over 6 month period 
y_36 <- apply(y, 2, mean)
# calculate the risk free rate return 
rf <- mean(by_month$DGS3MO)
# log return 
mu_36 <- rf + sum(as.vector(w)*(y_36))
# volatility
std_36 <- sqrt((w) %*% Sigma %*% w)
# Sharpe ratio
s_36 <- (mu_36 - rf)/std_36
results <- data.frame(timeline = c("6 Months", "1 Year", "2 Years", "3 Years"),
                      return = c(mu_6, mu_12, mu_24, mu_36), 
                      volatility = c(std_6, std_12, std_24, std_36), 
                      sharpe = c(s_6, s_12, s_24, s_36))
knitr::kable(results)
```



